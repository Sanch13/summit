{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>Регистрация пользователя</title>
{% endblock title %}

{% block css %}
    <link href="{% static 'css/style.css' %}" rel="stylesheet"/>
{% endblock css %}

{% block content %}
<div class="container center-content">
    <div class="card shadow-lg w-100" style="max-width: 400px;">
        <div class="card-body">
            <h2 class="card-title text-center mb-4">Регистрация</h2>

            <form method="post" action="{% url 'users:registration' %}" id="reg-form">
                {% csrf_token %}

                <div class="position-relative">
                    <label for="id_email" class="form-label">Email</label>
                    <input type="email"
                           name="email"
                           id="id_email"
                           class="form-control my-form"
                           placeholder="Электронная почта"
                           required>
                    <div id="id_email-error" class="error-message">

                    </div>
                </div>

                <div class="position-relative">
                    <label for="id_password1" class="form-label">Пароль</label>
                    <input type="password"
                           name="password1"
                           id="id_password1"
                           class="form-control my-form"
                           placeholder="Пароль"
                           required>
                    <span class="password-toggle" onclick="togglePasswordVisibility1()">
                        <i id="eyeIcon1" class="bi bi-eye-slash"></i>
                    </span>
                    <div id="id_password1-error" class="error-message">

                    </div>
                </div>

                <div class="position-relative">
                    <label for="id_password2" class="form-label">Подтвердите пароль</label>
                    <input type="password"
                           name="password2"
                           id="id_password2"
                           class="form-control my-form"
                           placeholder="Подтвердите пароль"
                           required>
                    <span class="password-toggle" onclick="togglePasswordVisibility2()">
                        <i id="eyeIcon2" class="bi bi-eye-slash"></i>
                    </span>
                    <div id="id_password2-error" class="error-message">
                    </div>
                </div>

                <div class="position-relative">
                    <label for="id_phone_number" class="form-label">Телефон</label>
                    <input type="tel"
                           name="phone_number"
                           id="id_phone_number"
                           class="form-control my-form"
                           placeholder="+375(__)___-__-__"
                           required>
                    <div id="id_phone_number-error" class="error-message">

                    </div>
                </div>

                <div class="position-relative">
                    <label for="id_first_name" class="form-label">Имя</label>
                    <input type="text"
                           name="first_name"
                           id="id_first_name"
                           class="form-control my-form"
                           placeholder="Имя"
                           required>
                    <div id="id_first_name-error" class="error-message">
                    </div>
                </div>

                <div class="position-relative">
                    <label for="id_last_name" class="form-label">Фамилия</label>
                    <input type="text"
                           name="last_name"
                           id="id_last_name"
                           class="form-control my-form"
                           placeholder="Фамилия"
                           required>
                    <div id="id_last_name-error" class="error-message">
                    </div>
                </div>

                <div class="mb-1 form-check">
                    <input class="form-check-input" type="checkbox" id="checkboxAgree">
                    <label class="form-check-label" for="checkboxAgree">
                        Я согласен на обработку моих персональных данных
                    </label>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary" id="btn-send-data"
                            disabled>Зарегистрироваться
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#id_phone_number').inputmask({
        "mask": "+375(99)999-99-99",
        "clearMaskOnLostFocus": false, //  Маска остаётся видимой, когда поле теряет фокус
    });
});

</script>




<script>
    function checkAllFieldsValid() {
        const inputs = document.querySelectorAll('.form-control');
        const checkbox = document.getElementById('checkboxAgree');
        const submitButton = document.getElementById('btn-send-data')
        let allValid = true;

        inputs.forEach(input => {
            if (!input.classList.contains('is-valid')) {
                allValid = false;
            }
        });

        if (!allValid) {
            checkbox.checked = false;
        } else {
            if (checkbox.checked) {
                submitButton.removeAttribute('disabled');
            } else {
                submitButton.setAttribute('disabled', 'disabled');
            }
        }
    }

document.getElementById('checkboxAgree').addEventListener('click', checkAllFieldsValid);

function togglePasswordVisibility1() {
    const eyeIcon = document.getElementById('eyeIcon1');
    const passwordInput = document.getElementById('id_password1');

    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.classList.remove('bi-eye-slash');
        eyeIcon.classList.add('bi-eye');
    } else {
        passwordInput.type = 'password';
        eyeIcon.classList.remove('bi-eye');
        eyeIcon.classList.add('bi-eye-slash');
    }
}

function togglePasswordVisibility2() {
    const eyeIcon = document.getElementById('eyeIcon2');
    const passwordInput = document.getElementById('id_password2');

    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.classList.remove('bi-eye-slash');
        eyeIcon.classList.add('bi-eye');
    } else {
        passwordInput.type = 'password';
        eyeIcon.classList.remove('bi-eye');
        eyeIcon.classList.add('bi-eye-slash');
    }
}
</script>

<script type="module" src="{% static 'js/users/handlers_for_fields.js' %}"></script>
{% endblock content %}
