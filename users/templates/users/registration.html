{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>Регистрация пользователя</title>
{% endblock title %}

{% block css %}
    <link href="{% static 'css/style.css' %}" rel="stylesheet"/>
{% endblock css %}

{% block content %}
<div class="container center-content">
    <div class="card shadow-lg w-100" style="max-width: 400px;">
        <div class="card-body">
            <h2 class="card-title text-center mb-4">Регистрация</h2>

            <form method="post" action="{% url 'users:registration' %}" id="reg-form">
                {% csrf_token %}

                <div class="mb-3">
                    <label for="id_email" class="form-label">Email</label>
                    <input type="email"
                           name="email"
                           id="id_email"
                           class="form-control"
                           placeholder="Электронная почта"
                           required>
                </div>

                <div class="mb-3">
                    <label for="id_password1" class="form-label">Пароль</label>
                    <input type="password"
                           name="password1"
                           id="id_password1"
                           class="form-control"
                           placeholder="Пароль"
                           required>
                </div>

                <div class="mb-3">
                    <label for="id_password2" class="form-label">Подтвердите пароль</label>
                    <input type="password"
                           name="password2"
                           id="id_password2"
                           class="form-control"
                           placeholder="Подтвердите пароль"
                           required>

                </div>

                <div class="mb-3 position-relative">
                    <label for="id_phone_number" class="form-label">Телефон</label>
                    <input type="tel"
                           name="phone_number"
                           id="id_phone_number"
                           class="form-control"
                           placeholder="+375(__)___-__-__"
                           required>
                    <div id="phone-error" class="error-message">
                        Пожалуйста, введите полный номер телефона.
                    </div>
                </div>

                <div class="mb-3 position-relative">
                    <label for="id_first_name" class="form-label">Имя</label>
                    <input type="text"
                           name="first_name"
                           id="id_first_name"
                           class="form-control"
                           placeholder="Имя"
                           required>
                    <div class="error-message">
                        Текст
                    </div>
                </div>

                <div class="mb-3 position-relative">
                    <label for="id_last_name" class="form-label">Фамилия</label>
                    <input type="text"
                           name="last_name"
                           id="id_last_name"
                           class="form-control"
                           placeholder="Фамилия"
                           required>
                    <div class="error-message">
                        Текст
                    </div>
                </div>

                <div class="mb-1 form-check">
                    <input class="form-check-input" type="checkbox" id="checkboxAgree">
                    <label class="form-check-label" for="checkboxAgree">
                        Я согласен на обработку моих персональных данных
                    </label>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary" id="send-data">Зарегистрироваться
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#id_phone_number').inputmask({
        "mask": "+375(99)999-99-99",
        "clearMaskOnLostFocus": false, //  Маска остаётся видимой, когда поле теряет фокус
    });

    const phoneInput = document.getElementById('id_phone_number');

    phoneInput.addEventListener('blur', function () {
        const value = phoneInput.value || '+375(__)___-__-__'
        console.log(value)

        if (checkFullPhone(value)) {
            document.getElementById('id_phone_number').classList.add('is-invalid');
            document.getElementById('phone-error').style.display = 'block';
        } else {
            document.getElementById('id_phone_number').classList.remove('is-invalid');
            document.getElementById('phone-error').style.display = 'none';
            document.getElementById('id_phone_number').classList.add('is-valid');
        }

    });

    function checkFullPhone (value) {
        const indexArr = [5, 6, 8, 9, 10, 12, 13, 15, 16]
        if (typeof value !== 'string') {
            return false;
        }

        return indexArr.some(index => value.charAt(index) === '_');
    }

    $('#reg-form').submit(function(event) {
        event.preventDefault();

        // Получаем значения всех полей формы
        const phoneNumber = document.getElementById('id_phone_number').getAttribute('class').split(' ').includes('is-valid');
        const phoneVal = document.getElementById('id_phone_number').value || '+375(__)___-__-__';
        // Добавьте здесь получение значений других полей формы
        console.log('phoneNumber', phoneNumber);
        console.log('phoneVal', phoneVal);

        // Проверяем все поля на заполнение
        if (checkFullPhone(phoneVal)) {
            $('#id_phone_number').inputmask({
                "mask": "+375(99)999-99-99",
                "clearMaskOnLostFocus": false, //  Маска остаётся видимой, когда поле теряет фокус
            });
            document.getElementById('id_phone_number').classList.add('is-invalid');
            document.getElementById('phone-error').style.display = 'block';
            return; // Прекращаем выполнение кода, если хотя бы одно поле не заполнено
        }
        // Добавьте здесь проверки других полей формы
        // <input type="tel" name="phone_number" id="id_phone_number" class="form-control is-invalid" required="" inputmode="text" autocorrect="off">

        // Если все поля заполнены, отправляем форму на сервер
        {#this.submit();#}
    });

});
</script>

{% endblock content %}
# qwerty1302
